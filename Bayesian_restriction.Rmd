---
title: "Bayesian_restriction"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This markdown is for me to experiment with contrasts and restriction models from the bayestestR package. If it goes well, this could be added to the main Bayesian analysis script. The following script is based upon the example here: (https://easystats.github.io/bayestestR/articles/bayes_factors.html#specifying-correct-priors-for-factors-with-more-than-2-levels)

**TO DO**

- Try this again with weakly informative prior (cauchy distribution with median of 0.5)
- Remove link function and just use Gamma distribution (example uses just Gaussian distribution) so maybe that is the problem

Essentially make my example similar to the example given

## Load packages 

```{r load packages, message =FALSE}
library(dplyr) # data manipulation
library(tidyr) # data manipulation
library(ggplot2) # data vis
library(BayesFactor) # performs Bayesian ANOVA
library(rstanarm) # bayesian regression modelling
library(bayestestR) # describes Bayesian models and posterior distributions
library(bayesplot) # allows plots for posterior predictive distributions
library(loo) # Bayesian model comparison
library(arm) # computes Bayes factor for glm model
library(insight) # get posterior parameters 
library(fitdistrplus) # investigating the distribution of my data
```

## Load data

```{r load my data}
# rm(list = ls()) - clear global environment
# home working directory
# setwd("C:/Users/Courtney/Documents/PhD/Project/Experiment_Code/experiment_1")
setwd("C:/Users/pscmgo/OneDrive for Business/PhD/Project/Experiment_Code/experiment_1")
temp = list.files(pattern = c("magnitudedata", "*.csv"))
myfiles = lapply(temp, read.csv)
magnitudedata <- do.call(rbind.data.frame, myfiles)
```

## Setting heading levels as factors and setting contrasts

```{r factors}
magnitudedata <- magnitudedata %>%
  dplyr::filter(heading > 0)

magnitudedata$heading <- as.factor(magnitudedata$heading)

contrasts(magnitudedata$heading) <- "contr.sum"
```

First I sent my contrasts to "contr.sum" which compares each of my heading levels to the 2 degrees heading levels.

## Fitting Bayesian model for contr.sum contrasts

```{r contr.sum contrasts}
contrasts(magnitudedata$heading) <- "contr.sum"

fit_sum <- stan_glm(FirstSteeringTime ~ heading, family = Gamma(link = "identity"), adapt_delta = 0.999, data = magnitudedata)

c_sum <- pairs(emmeans(fit_sum, ~ heading))
c_sum
```

## Fitting Bayesian model for contr.bayes contrasts

```{r contr.bayes contrasts}
contrasts(magnitudedata$heading) <- "contr.bayes"

fit_bayes <- stan_glm(FirstSteeringTime ~ heading, family = Gamma(link = "identity"), adapt_delta = 0.999, data = magnitudedata)

c_bayes <- pairs(emmeans(fit_bayes, ~ heading))
c_bayes
```

## Construcing hypothesis restriction

```{r hypothesis for restriction}
hyp <- c("2 < 1.5  & 1 < 0.5")
```


## Restriction model for contr.sum model

```{r contr.sum restriction}
em_sum <- emmeans(fit_sum, ~ heading)
em_sum # the posterior marginal means

bayesfactor_restricted(em_sum, fit_sum, hypothesis = hyp)
```


